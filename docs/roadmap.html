<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEMO í”„ë¡œì íŠ¸ ë¡œë“œë§µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: linear-gradient(135deg, #1f6feb 0%, #0969da 100%);
            padding: 40px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 8px 24px rgba(31, 111, 235, 0.3);
        }

        h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            color: #ffffff;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            color: #ffffff;
        }

        .controls {
            background: #161b22;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        label {
            font-weight: 600;
            color: #8b949e;
        }

        select, button {
            background: #21262d;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        select:hover, button:hover {
            background: #30363d;
            border-color: #8b949e;
        }

        button.refresh {
            background: #238636;
            border-color: #238636;
            color: white;
            font-weight: 600;
        }

        button.refresh:hover {
            background: #2ea043;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            font-size: 1.2em;
            color: #8b949e;
        }

        .loading::after {
            content: '...';
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .error {
            background: #da3633;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #161b22;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #30363d;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: #1f6feb;
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #58a6ff;
        }

        .stat-label {
            color: #8b949e;
            margin-top: 5px;
        }

        .timeline {
            position: relative;
            padding: 20px 0;
        }

        .month-section {
            margin-bottom: 40px;
        }

        .month-header {
            font-size: 1.5em;
            font-weight: 700;
            color: #58a6ff;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #30363d;
        }

        .project-group {
            margin-bottom: 30px;
            background: #161b22;
            border-radius: 8px;
            border: 1px solid #30363d;
            overflow: hidden;
        }

        .project-header {
            background: #21262d;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .project-header:hover {
            background: #30363d;
        }

        .project-title {
            font-size: 1.2em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .project-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-active { background: #238636; color: white; }
        .status-pending { background: #9e6a03; color: white; }
        .status-completed { background: #8b949e; color: white; }
        .status-planning { background: #1f6feb; color: white; }

        .project-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            color: #8b949e;
        }

        .project-body {
            padding: 20px;
            border-top: 1px solid #30363d;
        }

        .epic-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .epic-item {
            background: #0d1117;
            padding: 15px;
            border-radius: 6px;
            border-left: 3px solid #1f6feb;
            transition: all 0.2s;
        }

        .epic-item:hover {
            border-left-color: #58a6ff;
            transform: translateX(5px);
        }

        .epic-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .epic-title {
            font-weight: 600;
            color: #58a6ff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .epic-number {
            color: #8b949e;
            font-size: 0.9em;
        }

        .progress-bar {
            background: #21262d;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #238636 0%, #2ea043 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.85em;
            color: #8b949e;
            margin-top: 5px;
        }

        .task-list {
            margin-top: 15px;
            padding-left: 20px;
        }

        .task-item {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9em;
        }

        .task-checkbox {
            width: 16px;
            height: 16px;
            border: 2px solid #30363d;
            border-radius: 3px;
            display: inline-block;
            flex-shrink: 0;
        }

        .task-checkbox.checked {
            background: #238636;
            border-color: #238636;
            position: relative;
        }

        .task-checkbox.checked::after {
            content: 'âœ“';
            color: white;
            position: absolute;
            top: -2px;
            left: 2px;
            font-size: 12px;
        }

        .task-link {
            color: #8b949e;
            text-decoration: none;
            transition: color 0.2s;
        }

        .task-link:hover {
            color: #58a6ff;
            text-decoration: underline;
        }

        .task-completed {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .expand-icon {
            transition: transform 0.3s;
        }

        .expanded .expand-icon {
            transform: rotate(90deg);
        }

        .collapsed .project-body {
            display: none;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            header {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .control-group {
                width: 100%;
            }

            select, button {
                width: 100%;
            }
        }

        footer {
            text-align: center;
            margin-top: 60px;
            padding: 20px;
            color: #8b949e;
            border-top: 1px solid #30363d;
        }

        .footer-link {
            color: #58a6ff;
            text-decoration: none;
        }

        .footer-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š SEMO í”„ë¡œì íŠ¸ ë¡œë“œë§µ</h1>
            <p class="subtitle">ì‚¬ì—… í”„ë¡œì íŠ¸ â†’ Epic â†’ Task ê³„ì¸µ êµ¬ì¡° íƒ€ì„ë¼ì¸</p>
        </header>

        <div class="controls">
            <div class="control-group">
                <label for="viewType">ë³´ê¸°:</label>
                <select id="viewType">
                    <option value="timeline">íƒ€ì„ë¼ì¸</option>
                    <option value="hierarchy">ê³„ì¸µ êµ¬ì¡°</option>
                    <option value="status">ìƒíƒœë³„</option>
                </select>
            </div>
            <div class="control-group">
                <label for="filterStatus">í•„í„°:</label>
                <select id="filterStatus">
                    <option value="all">ì „ì²´</option>
                    <option value="active">ì§„í–‰ì¤‘</option>
                    <option value="completed">ì™„ë£Œ</option>
                    <option value="pending">ëŒ€ê¸°</option>
                </select>
            </div>
            <button class="refresh" onclick="loadProjects()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>

        <div class="stats" id="stats">
            <!-- í†µê³„ ì¹´ë“œê°€ ì—¬ê¸° ë Œë”ë§ë©ë‹ˆë‹¤ -->
        </div>

        <div id="content">
            <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</div>
        </div>

        <footer>
            <p>ìµœì¢… ì—…ë°ì´íŠ¸: <span id="lastUpdate">-</span></p>
            <p>
                <a href="https://github.com/orgs/semicolon-devteam/projects/6" class="footer-link" target="_blank">ì‚¬ì—…ê´€ë¦¬ í”„ë¡œì íŠ¸</a> |
                <a href="https://github.com/orgs/semicolon-devteam/projects/1" class="footer-link" target="_blank">ì´ìŠˆê´€ë¦¬ í”„ë¡œì íŠ¸</a>
            </p>
        </footer>
    </div>

    <script>
        // GitHub Projects GraphQL API ì„¤ì •
        const GITHUB_TOKEN = localStorage.getItem('github_token') || prompt('GitHub Personal Access Tokenì„ ì…ë ¥í•˜ì„¸ìš”:\n(Settings â†’ Developer settings â†’ Personal access tokens â†’ Generate new token)\nê¶Œí•œ: repo, read:org, read:project');

        if (GITHUB_TOKEN) {
            localStorage.setItem('github_token', GITHUB_TOKEN);
        }

        const GRAPHQL_ENDPOINT = 'https://api.github.com/graphql';

        // ë°ì´í„° ì €ì¥ì†Œ
        let projectsData = [];
        let epicsData = [];

        // GitHub API í˜¸ì¶œ í•¨ìˆ˜
        async function fetchGraphQL(query) {
            const response = await fetch(GRAPHQL_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${GITHUB_TOKEN}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ query })
            });

            if (!response.ok) {
                throw new Error(`GitHub API Error: ${response.status}`);
            }

            const data = await response.json();
            if (data.errors) {
                throw new Error(data.errors[0].message);
            }

            return data.data;
        }

        // ì‚¬ì—…ê´€ë¦¬ í”„ë¡œì íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function fetchBusinessProjects() {
            const query = `
                query {
                    organization(login: "semicolon-devteam") {
                        projectV2(number: 6) {
                            items(first: 100) {
                                nodes {
                                    id
                                    content {
                                        ... on Issue {
                                            number
                                            title
                                            url
                                            body
                                            state
                                            labels(first: 10) {
                                                nodes {
                                                    name
                                                }
                                            }
                                        }
                                    }
                                    fieldValues(first: 20) {
                                        nodes {
                                            ... on ProjectV2ItemFieldTextValue {
                                                text
                                                field {
                                                    ... on ProjectV2Field {
                                                        name
                                                    }
                                                }
                                            }
                                            ... on ProjectV2ItemFieldSingleSelectValue {
                                                name
                                                field {
                                                    ... on ProjectV2SingleSelectField {
                                                        name
                                                    }
                                                }
                                            }
                                            ... on ProjectV2ItemFieldDateValue {
                                                date
                                                field {
                                                    ... on ProjectV2Field {
                                                        name
                                                    }
                                                }
                                            }
                                            ... on ProjectV2ItemFieldNumberValue {
                                                number
                                                field {
                                                    ... on ProjectV2Field {
                                                        name
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            `;

            const data = await fetchGraphQL(query);
            return data.organization.projectV2.items.nodes;
        }

        // Epic ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì´ìŠˆ ë²ˆí˜¸ ë°°ì—´ë¡œ)
        async function fetchEpics(epicNumbers) {
            if (!epicNumbers || epicNumbers.length === 0) return [];

            const epicQueries = epicNumbers.map((num, idx) => `
                epic${idx}: repository(owner: "semicolon-devteam", name: "command-center") {
                    issue(number: ${num}) {
                        number
                        title
                        url
                        body
                        state
                    }
                }
            `).join('\n');

            const query = `
                query {
                    ${epicQueries}
                }
            `;

            const data = await fetchGraphQL(query);

            return Object.values(data)
                .map(repo => repo.issue)
                .filter(issue => issue !== null);
        }

        // Issue bodyì—ì„œ Epic ë²ˆí˜¸ ì¶”ì¶œ (ìë™ íŒŒì‹±)
        function parseEpicNumbers(body) {
            if (!body) return [];

            const epicNumbers = new Set();

            // íŒ¨í„´ 1: #71, #72 í˜•ì‹ (ê°™ì€ ë ˆí¬)
            const hashPattern = /#(\d+)/g;
            let match;
            while ((match = hashPattern.exec(body)) !== null) {
                epicNumbers.add(parseInt(match[1]));
            }

            // íŒ¨í„´ 2: semicolon-devteam/command-center#71 í˜•ì‹
            const repoPattern = /semicolon-devteam\/command-center#(\d+)/g;
            while ((match = repoPattern.exec(body)) !== null) {
                epicNumbers.add(parseInt(match[1]));
            }

            // íŒ¨í„´ 3: GitHub URL í˜•ì‹
            const urlPattern = /github\.com\/semicolon-devteam\/command-center\/issues\/(\d+)/g;
            while ((match = urlPattern.exec(body)) !== null) {
                epicNumbers.add(parseInt(match[1]));
            }

            return Array.from(epicNumbers).sort((a, b) => a - b);
        }

        // Epic ë°ì´í„° íŒŒì‹± (Issue bodyì—ì„œ Task list ì¶”ì¶œ)
        function parseTaskList(body) {
            if (!body) return [];

            const taskRegex = /- \[([ x])\] (.+?)(?:\((.+?)\))?$/gm;
            const tasks = [];
            let match;

            while ((match = taskRegex.exec(body)) !== null) {
                tasks.push({
                    completed: match[1] === 'x',
                    title: match[2].trim(),
                    note: match[3] || ''
                });
            }

            return tasks;
        }

        // í•„ë“œ ê°’ ì¶”ì¶œ í—¬í¼
        function getFieldValue(item, fieldName) {
            const field = item.fieldValues?.nodes?.find(f => f.field?.name === fieldName);
            return field?.text || field?.name || field?.date || field?.number || null;
        }

        // ë°ì´í„° ì²˜ë¦¬ ë° ë Œë”ë§
        async function loadProjects() {
            const contentDiv = document.getElementById('content');
            const statsDiv = document.getElementById('stats');

            try {
                contentDiv.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>';

                const items = await fetchBusinessProjects();

                // ë°ì´í„° íŒŒì‹±
                projectsData = await Promise.all(items.map(async item => {
                    const content = item.content;
                    if (!content) return null;

                    const projectNumber = content.number;

                    // Epic ë²ˆí˜¸ ìë™ íŒŒì‹± (Issue bodyì—ì„œ)
                    const epicNumbers = parseEpicNumbers(content.body);

                    // Epic ë°ì´í„° ë¡œë“œ
                    let epics = [];
                    if (epicNumbers.length > 0) {
                        contentDiv.innerHTML = `<div class="loading">${content.title} Epic ë°ì´í„° ë¡œë“œ ì¤‘...</div>`;
                        epics = await fetchEpics(epicNumbers);
                        epics = epics.map(epic => ({
                            number: epic.number,
                            title: epic.title,
                            url: epic.url,
                            state: epic.state,
                            tasks: parseTaskList(epic.body)
                        }));
                    }

                    return {
                        number: projectNumber,
                        title: content.title,
                        url: content.url,
                        body: content.body,
                        state: content.state,
                        status: getFieldValue(item, 'ìƒíƒœ') || getFieldValue(item, 'Status'),
                        category: getFieldValue(item, 'ì¹´í…Œê³ ë¦¬'),
                        targetDate: getFieldValue(item, 'ëª©í‘œì¼'),
                        budget: getFieldValue(item, 'ì˜ˆì‚°'),
                        priority: getFieldValue(item, 'ì¤‘ìš”ë„'),
                        revenue: getFieldValue(item, 'ì›”ê°„ ìˆ˜ìµ'),
                        epics: epics
                    };
                }));

                projectsData = projectsData.filter(p => p !== null);

                // í†µê³„ ê³„ì‚°
                renderStats(projectsData);

                // íƒ€ì„ë¼ì¸ ë Œë”ë§
                renderTimeline(projectsData);

                // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
                document.getElementById('lastUpdate').textContent = new Date().toLocaleString('ko-KR');

            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="error">
                        <strong>ì˜¤ë¥˜ ë°œìƒ:</strong> ${error.message}<br><br>
                        GitHub Personal Access Tokenì´ í•„ìš”í•©ë‹ˆë‹¤.<br>
                        <button onclick="resetToken()">í† í° ì¬ì„¤ì •</button>
                    </div>
                `;
            }
        }

        // í†µê³„ ë Œë”ë§
        function renderStats(projects) {
            const total = projects.length;
            const active = projects.filter(p => p.status?.includes('ì§„í–‰') || p.status?.includes('ì‘ì—…')).length;
            const completed = projects.filter(p => p.status?.includes('ì™„ë£Œ') || p.status === 'âœ… ì™„ë£Œ').length;
            const totalBudget = projects.reduce((sum, p) => sum + (p.budget || 0), 0);

            document.getElementById('stats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${total}</div>
                    <div class="stat-label">ì „ì²´ í”„ë¡œì íŠ¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${active}</div>
                    <div class="stat-label">ì§„í–‰ì¤‘</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${completed}</div>
                    <div class="stat-label">ì™„ë£Œ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">â‚©${(totalBudget / 10000).toFixed(0)}ë§Œ</div>
                    <div class="stat-label">ì´ ì˜ˆì‚°</div>
                </div>
            `;
        }

        // íƒ€ì„ë¼ì¸ ë Œë”ë§
        function renderTimeline(projects) {
            // ëª©í‘œì¼ ê¸°ì¤€ ê·¸ë£¹í•‘
            const grouped = {};
            const noDateProjects = [];

            projects.forEach(project => {
                if (!project.targetDate) {
                    noDateProjects.push(project);
                    return;
                }

                const date = new Date(project.targetDate);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;

                if (!grouped[monthKey]) {
                    grouped[monthKey] = [];
                }
                grouped[monthKey].push(project);
            });

            // ë‚ ì§œ ì—­ìˆœ ì •ë ¬ (ìµœì‹ ì´ ë¨¼ì €)
            const sortedMonths = Object.keys(grouped).sort((a, b) => b.localeCompare(a));

            let html = '<div class="timeline">';

            sortedMonths.forEach(monthKey => {
                const [year, month] = monthKey.split('-');
                const monthName = `${year}ë…„ ${parseInt(month)}ì›”`;

                html += `
                    <div class="month-section">
                        <div class="month-header">${monthName}</div>
                `;

                // ì›” ë‚´ì—ì„œë„ ìµœì‹ ìˆœ ì •ë ¬ (ëª©í‘œì¼ ê¸°ì¤€)
                const monthProjects = grouped[monthKey].sort((a, b) => {
                    return new Date(b.targetDate) - new Date(a.targetDate);
                });

                monthProjects.forEach(project => {
                    html += renderProject(project);
                });

                html += '</div>';
            });

            // ëª©í‘œì¼ ì—†ëŠ” í”„ë¡œì íŠ¸ë“¤ (ë§¨ ë§ˆì§€ë§‰ì— í‘œì‹œ)
            if (noDateProjects.length > 0) {
                html += `
                    <div class="month-section">
                        <div class="month-header">ëª©í‘œì¼ ë¯¸ì •</div>
                `;

                noDateProjects.forEach(project => {
                    html += renderProject(project);
                });

                html += '</div>';
            }

            html += '</div>';

            document.getElementById('content').innerHTML = html;
        }

        // í”„ë¡œì íŠ¸ ì¹´ë“œ ë Œë”ë§
        function renderProject(project) {
            const statusClass = getStatusClass(project.status);

            // Epic ì „ì²´ ì§„í–‰ë¥  ê³„ì‚°
            let totalTasks = 0;
            let completedTasks = 0;

            if (project.epics && project.epics.length > 0) {
                project.epics.forEach(epic => {
                    if (epic.tasks) {
                        totalTasks += epic.tasks.length;
                        completedTasks += epic.tasks.filter(t => t.completed).length;
                    }
                });
            }

            const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

            return `
                <div class="project-group expanded" id="project-${project.number}">
                    <div class="project-header" onclick="toggleProject(${project.number})">
                        <div>
                            <div class="project-title">
                                <span class="expand-icon">â–¶</span>
                                <a href="${project.url}" target="_blank" style="color: inherit; text-decoration: none;">
                                    ${project.title}
                                </a>
                                <span class="project-status ${statusClass}">${project.status || 'ìƒíƒœ ì—†ìŒ'}</span>
                            </div>
                            <div class="project-meta">
                                ${project.targetDate ? `<span>ğŸ“… ${project.targetDate}</span>` : ''}
                                ${project.budget ? `<span>ğŸ’° â‚©${(project.budget / 10000).toFixed(0)}ë§Œ</span>` : ''}
                                ${project.revenue ? `<span>ğŸ’µ ì›” â‚©${project.revenue}</span>` : ''}
                                ${project.category ? `<span>ğŸ“‚ ${project.category}</span>` : ''}
                                ${project.epics ? `<span>ğŸ“Š Epic ${project.epics.length}ê°œ</span>` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="project-body">
                        ${totalTasks > 0 ? `
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="progress-text">${progress}% ì™„ë£Œ (${completedTasks}/${totalTasks} Task)</div>
                        ` : ''}
                        ${renderEpics(project.epics)}
                    </div>
                </div>
            `;
        }

        // Epic ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        function renderEpics(epics) {
            if (!epics || epics.length === 0) {
                return '<p style="color: #8b949e; padding: 10px 0;">Epic ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }

            return epics.map(epic => {
                const epicProgress = calculateProgress(epic.tasks);
                const epicStatusClass = epic.state === 'CLOSED' ? 'status-completed' : 'status-active';

                return `
                    <div class="epic-group" style="margin: 15px 0; padding: 15px; background: #161b22; border-radius: 6px; border-left: 3px solid #1f6feb;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div>
                                <a href="${epic.url}" target="_blank" style="color: #58a6ff; text-decoration: none; font-weight: 600;">
                                    #${epic.number} ${epic.title}
                                </a>
                                <span class="project-status ${epicStatusClass}" style="margin-left: 8px;">
                                    ${epic.state === 'CLOSED' ? 'ì™„ë£Œ' : 'ì§„í–‰ì¤‘'}
                                </span>
                            </div>
                            <div style="color: #8b949e; font-size: 0.9em;">
                                ${epic.tasks ? `${epic.tasks.filter(t => t.completed).length}/${epic.tasks.length} Task` : ''}
                            </div>
                        </div>
                        ${renderTasks(epic.tasks, epicProgress)}
                    </div>
                `;
            }).join('');
        }

        // Task ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        function renderTasks(tasks, progress) {
            if (!tasks || tasks.length === 0) {
                return '<p style="color: #8b949e; font-size: 0.9em; margin: 5px 0;">Task ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }

            return `
                <div class="task-list" style="margin-top: 10px;">
                    ${tasks.map(task => `
                        <div class="task-item">
                            <span class="task-checkbox ${task.completed ? 'checked' : ''}"></span>
                            <span class="${task.completed ? 'task-completed' : ''}">${task.title}</span>
                            ${task.note ? `<span style="color: #8b949e; font-size: 0.85em;">${task.note}</span>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // í—¬í¼ í•¨ìˆ˜ë“¤
        function getStatusClass(status) {
            if (!status) return '';
            if (status.includes('ì§„í–‰') || status.includes('ì‘ì—…')) return 'status-active';
            if (status.includes('ì™„ë£Œ')) return 'status-completed';
            if (status.includes('ëŒ€ê¸°') || status.includes('ìŠ¹ì¸')) return 'status-pending';
            if (status.includes('ê³„íš')) return 'status-planning';
            return '';
        }

        function calculateProgress(tasks) {
            if (!tasks || tasks.length === 0) return 0;
            const completed = tasks.filter(t => t.completed).length;
            return Math.round((completed / tasks.length) * 100);
        }

        function toggleProject(number) {
            const element = document.getElementById(`project-${number}`);
            element.classList.toggle('expanded');
            element.classList.toggle('collapsed');
        }

        function resetToken() {
            localStorage.removeItem('github_token');
            location.reload();
        }

        // í•„í„° ì´ë²¤íŠ¸
        document.getElementById('filterStatus').addEventListener('change', (e) => {
            const filter = e.target.value;
            let filtered = projectsData;

            if (filter !== 'all') {
                filtered = projectsData.filter(p => {
                    const status = p.status?.toLowerCase() || '';
                    if (filter === 'active') return status.includes('ì§„í–‰') || status.includes('ì‘ì—…');
                    if (filter === 'completed') return status.includes('ì™„ë£Œ');
                    if (filter === 'pending') return status.includes('ëŒ€ê¸°') || status.includes('ìŠ¹ì¸');
                    return true;
                });
            }

            renderTimeline(filtered);
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', () => {
            if (GITHUB_TOKEN) {
                loadProjects();
            }
        });
    </script>
</body>
</html>
